data HPA;
input Id GrLivArea Neighborhood $ SalePrice;
datalines;
10 1077 BrkSide 118000
15 1253 NAmes 157000
16 854 BrkSide 132000
17 1004 NAmes 149000
20 1339 NAmes 139000
27 900 NAmes 134800
29 1600 NAmes 207500
30 520 BrkSide 68500
34 1700 NAmes 165500
38 1297 NAmes 153000
39 1057 NAmes 109000
40 1152 Edwards 82000
41 1324 NAmes 160000
45 1150 NAmes 141000
52 1176 BrkSide 114500
55 1360 NAmes 130000
56 1425 NAmes 180500
67 2207 NAmes 180000
71 2223 NAmes 244000
74 1086 NAmes 144900
77 952 NAmes 135750
78 1285 BrkSide 127000
81 2142 NAmes 193500
84 1065 NAmes 126500
91 1040 NAmes 109900
92 1235 NAmes 98600
98 960 Edwards 94750
99 835 Edwards 83000
100 1225 NAmes 128950
111 1855 Edwards 136900
118 1125 Edwards 155000
123 1080 NAmes 136000
129 1348 NAmes 155000
130 1053 NAmes 150000
131 2157 NAmes 226000
133 1327 NAmes 150750
137 1214 NAmes 143000
141 864 NAmes 115000
143 1385 NAmes 166000
146 1709 Edwards 130000
147 875 BrkSide 105000
150 1344 BrkSide 115000
156 1096 Edwards 79000
157 1040 NAmes 109500
166 1355 Edwards 127500
172 1656 NAmes 215000
174 1362 NAmes 163000
176 2158 Edwards 243000
183 1340 Edwards 120000
185 1252 BrkSide 127000
192 1479 NAmes 184000
194 1709 Edwards 130000
198 3112 NAmes 235000
201 1121 Edwards 140000
208 1100 NAmes 141000
210 1092 NAmes 145000
211 864 Edwards 98000
212 1212 Edwards 186000
216 1236 NAmes 134450
224 864 NAmes 97000
231 1194 NAmes 148000
240 1487 Edwards 113000
248 1375 NAmes 140000
251 1306 BrkSide 76500
254 1302 NAmes 158000
255 1314 NAmes 145000
261 1382 NAmes 176000
270 1113 Edwards 148000
274 1632 NAmes 139000
276 1548 BrkSide 205000
287 1734 NAmes 159000
288 858 NAmes 88000
290 1396 BrkSide 153575
293 1716 Edwards 131000
295 1644 NAmes 167000
309 861 Edwards 82500
312 972 NAmes 132000
325 2978 NAmes 242000
328 1383 NAmes 145250
329 2134 BrkSide 214500
331 1728 NAmes 119000
332 1056 NAmes 139000
340 1215 NAmes 155000
343 1040 NAmes 87500
346 1577 BrkSide 140200
347 958 NAmes 151500
348 1478 NAmes 157500
353 1111 Edwards 95000
362 1505 BrkSide 145000
363 1922 Edwards 198500
367 1394 NAmes 159000
368 1431 NAmes 165000
369 1268 NAmes 132000
370 1287 NAmes 162000
374 1319 NAmes 123000
376 904 Edwards 61000
387 1184 Edwards 81000
388 1125 Edwards 125000
391 1367 Edwards 119000
393 882 NAmes 106500
394 788 BrkSide 1E+05
396 1144 Edwards 129000
398 1812 NAmes 169500
411 1276 Edwards 60000
419 1134 Edwards 126000
420 1056 NAmes 142000
425 1196 NAmes 139000
428 907 NAmes 109008
438 904 BrkSide 119000
440 1196 Edwards 110000
442 1440 Edwards 118000
443 1573 BrkSide 162900
446 1689 Edwards 127500
447 1888 NAmes 190000
460 1203 BrkSide 110000
467 1277 NAmes 167000
468 1644 NAmes 146500
473 1072 Edwards 148000
486 1113 NAmes 147000
487 1073 NAmes 156000
492 1578 NAmes 133000
494 1269 NAmes 155000
498 1820 BrkSide 184000
500 912 NAmes 120000
503 1214 Edwards 140000
510 1041 NAmes 124500
511 1363 NAmes 164900
513 864 NAmes 129900
522 1244 NAmes 150000
523 1664 BrkSide 159000
524 4676 Edwards 184750
527 928 NAmes 132000
529 605 Edwards 86000
532 1362 BrkSide 128000
533 827 NAmes 107500
534 334 BrkSide 39300
536 1347 Edwards 107500
538 864 NAmes 111250
544 767 NAmes 133000
547 1635 BrkSide 210000
554 1126 Edwards 108000
556 1048 BrkSide 113000
557 1092 NAmes 141000
563 996 Edwards 108000
564 1674 Edwards 185000
570 943 NAmes 135960
571 1728 NAmes 142600
572 864 NAmes 120000
575 1109 NAmes 139000
576 1216 NAmes 118500
581 1429 NAmes 181900
583 816 Edwards 118500
585 1573 BrkSide 133000
587 838 BrkSide 130000
590 935 BrkSide 79500
606 1986 NAmes 205000
608 2008 Edwards 225000
616 1054 NAmes 137500
618 832 NAmes 105500
621 864 Edwards 67000
626 1116 NAmes 160000
627 1422 NAmes 139900
628 1520 NAmes 153000
629 2080 NAmes 135000
630 1350 NAmes 168500
634 1056 NAmes 139400
637 800 BrkSide 60000
639 796 Edwards 85000
643 2704 NAmes 345000
646 981 NAmes 143250
647 1048 NAmes 98300
648 1094 Edwards 155000
649 1839 NAmes 155000
652 1510 Edwards 108000
657 1053 NAmes 145500
659 1458 NAmes 97500
660 1486 Edwards 167000
663 1392 NAmes 110000
664 1181 Edwards 137500
667 2380 NAmes 129000
672 1369 Edwards 103600
675 1136 NAmes 140000
695 1539 BrkSide 141500
697 616 BrkSide 89000
698 1148 Edwards 123500
711 729 BrkSide 52000
714 960 BrkSide 129000
723 864 NAmes 124500
724 1470 Edwards 135000
725 1698 Edwards 320000
726 864 NAmes 120500
729 1776 NAmes 110000
737 1040 NAmes 93500
739 1200 Edwards 179000
750 1529 Edwards 98000
755 1026 NAmes 156000
761 864 NAmes 127500
762 1301 BrkSide 1E+05
772 1220 Edwards 102000
773 1117 Edwards 107000
774 912 NAmes 114500
798 773 NAmes 110000
805 1128 NAmes 118000
807 980 NAmes 135500
808 1576 BrkSide 223500
809 1086 NAmes 159950
814 1442 NAmes 157900
815 1250 Edwards 116000
817 1008 NAmes 137000
827 784 BrkSide 109500
831 1392 NAmes 166000
834 1516 NAmes 167000
835 1144 NAmes 139950
840 1200 Edwards 130500
843 1165 NAmes 174900
844 1800 NAmes 141000
854 1445 NAmes 158000
864 1148 NAmes 132500
866 1002 NAmes 148500
871 894 NAmes 109500
873 910 NAmes 116000
874 1268 NAmes 133000
881 1090 Edwards 157000
885 892 NAmes 1E+05
887 1712 NAmes 145000
888 1393 Edwards 135500
889 2217 NAmes 268000
890 1505 NAmes 149500
891 924 NAmes 122900
896 1796 NAmes 140000
901 858 NAmes 110000
902 1306 NAmes 153000
906 1063 NAmes 128000
911 2274 NAmes 154300
913 1015 BrkSide 88000
918 1229 Edwards 135000
920 1414 NAmes 176500
922 2200 Edwards 145900
932 925 NAmes 117500
935 2069 NAmes 242000
936 747 BrkSide 79900
943 1440 Edwards 150000
947 1144 NAmes 143000
951 864 NAmes 129000
955 980 Edwards 127500
961 858 BrkSide 116500
968 1098 NAmes 135000
970 1095 NAmes 140000
971 1192 NAmes 135000
975 2019 BrkSide 167500
977 869 BrkSide 85500
979 894 Edwards 110000
981 999 NAmes 178400
986 1164 Edwards 125000
993 1851 NAmes 187000
996 1230 BrkSide 121600
997 1050 NAmes 136500
1001 944 Edwards 82000
1007 1657 NAmes 163500
1012 1664 Edwards 1E+05
1015 1082 NAmes 119200
1021 1132 Edwards 176000
1027 1264 NAmes 167500
1029 1376 NAmes 105000
1036 845 Edwards 84000
1046 1733 Edwards 139600
1050 930 Edwards 84900
1053 1977 NAmes 165000
1054 1526 Edwards 144500
1065 1154 NAmes 154000
1068 1611 NAmes 167900
1070 893 NAmes 135000
1071 1048 NAmes 135000
1073 1456 Edwards 91500
1074 1426 Edwards 159500
1078 1096 NAmes 138800
1084 1251 NAmes 160000
1089 1709 Edwards 137500
1091 1040 NAmes 92900
1094 1200 NAmes 146000
1095 936 NAmes 129000
1099 1324 BrkSide 128000
1102 950 NAmes 119500
1103 1134 NAmes 135000
1104 1194 NAmes 159500
1113 816 NAmes 129900
1114 1008 NAmes 134500
1120 1040 NAmes 133700
1123 960 Edwards 112000
1124 698 Edwards 118000
1126 1005 NAmes 115000
1136 986 BrkSide 102000
1137 1252 NAmes 119000
1140 1167 BrkSide 144000
1141 952 NAmes 139000
1145 924 Edwards 80000
1146 1576 BrkSide 149000
1151 932 NAmes 124000
1152 1466 Edwards 149900
1155 1820 NAmes 201800
1157 1265 NAmes 179900
1169 2108 Edwards 235000
1172 1261 NAmes 163000
1180 1124 Edwards 93000
1186 1221 Edwards 104900
1201 864 NAmes 116050
1203 1348 BrkSide 117000
1209 1283 NAmes 140000
1213 672 Edwards 113000
1215 999 NAmes 134500
1219 912 BrkSide 80500
1221 912 NAmes 115000
1223 1846 NAmes 143000
1224 2136 NAmes 137900
1226 1138 NAmes 145000
1228 912 NAmes 147000
1230 1507 NAmes 127000
1232 1190 NAmes 132500
1233 1224 NAmes 101800
1234 1188 NAmes 142000
1250 988 NAmes 119000
1251 2110 NAmes 244000
1255 1656 Edwards 165400
1256 1367 BrkSide 127500
1258 864 Edwards 99900
1260 1054 NAmes 151000
1262 1050 NAmes 128900
1264 1824 BrkSide 180500
1265 1337 NAmes 181000
1270 1524 NAmes 144000
1274 1357 Edwards 177000
1276 1920 NAmes 137000
1286 1412 BrkSide 132500
1291 1152 NAmes 180500
1295 864 Edwards 115000
1296 1052 NAmes 138500
1297 1128 NAmes 155000
1298 1072 Edwards 140000
1299 5642 Edwards 160000
1300 1246 NAmes 154000
1305 1708 Edwards 130000
1315 948 Edwards 119000
1316 2112 NAmes 206900
1320 948 Edwards 111000
1321 1478 NAmes 156500
1322 720 BrkSide 72500
1324 708 BrkSide 82500
1327 774 Edwards 79000
1333 816 Edwards 1E+05
1341 872 NAmes 123000
1351 2634 NAmes 2E+05
1352 1716 NAmes 171000
1353 1176 BrkSide 134900
1357 892 NAmes 110000
1358 1078 NAmes 149900
1363 1738 NAmes 104900
1372 1661 NAmes 165500
1378 1604 Edwards 117000
1381 864 Edwards 58500
1382 2117 NAmes 237500
1385 1258 Edwards 105000
1390 1218 BrkSide 131000
1392 1584 NAmes 124000
1393 900 NAmes 123000
1398 1513 BrkSide 137500
1399 1904 NAmes 138000
1401 1158 BrkSide 120000
1412 1668 NAmes 140000
1413 1040 NAmes 90000
1415 1848 BrkSide 207000
1419 1144 NAmes 124000
1424 2201 Edwards 274970
1425 1344 NAmes 144000
1426 1252 NAmes 142000
1428 1558 NAmes 140000
1436 1537 NAmes 174000
1437 864 NAmes 120500
1444 952 BrkSide 121000
1449 1346 Edwards 112000
1451 1792 NAmes 136000
1453 1072 Edwards 145000
1459 1078 NAmes 142125
1460 1256 Edwards 147500
;
run;

/*Scatter Plot*/
proc sgplot data = HPA;
scatter x= GrLivArea y = SalePrice / group=Neighborhood;
run;

/Matrix Plot - Display 6*/
proc sgscatter data=HPA;
matrix GrLivArea SalePrice / group=Neighborhood;
run;

/*Correlation Coefficient - Display 8*/
proc corr data = HPA;
var SalePrice GrLivArea;
run;

/*Fit a Model for Initial Analysis - Display 7, 9, 10, 12*/
PROC REG DATA=HPA plots=all;
  MODEL SalePrice = GrLivArea / STB;
RUN;

/*Get Outliers and Leverage Observtions on a plot - Display 11*/
proc reg data=HPA  plots(only label) =(CooksD RStudentByLeverage);
   model SalePrice = GrLivArea; /* can also use INFLUENCE option */
run;

/*Get DFFITS, COOKSD and H-Leverage - Display 11*/
PROC REG DATA=HPA;
  MODEL SalePrice = GrLivArea / STB;
  OUTPUT OUT=OutputDataset DFFITS=DFFITS COVRATIO=COOKD H=H;
RUN;

proc print data = OutputDataset;
run;

/*Get Variance Inflation, Partial Residuals*/
PROC REG DATA=HPA;
  MODEL SalePrice = GrLivArea / STB clb vif scorr1 scorr2;
run;

PROC REG DATA=HPA;
where GrLivArea < 4500;
  MODEL SalePrice = GrLivArea / STB clb vif scorr1 scorr2;
run;

/*Correlation improvement by limiting analysis to < 4500 sf*/
proc corr data = HPA;
where GrLivArea < 4500;
var SalePrice GrLivArea;
run;

/*Build a model with Conf Intervals - Display 3*/ 
proc glm data = HPA plots = all;
class Neighborhood;
model SalePrice = GrLivArea Neighborhood /solution clparm;
run;

/*Build a model with Conf Intervals by limiting analysis to < 4500 sf - Display 4*/
proc glm data = HPA plots = all;
where GrLivArea < 4500;
class Neighborhood;
model SalePrice = GrLivArea Neighborhood /solution clparm;
run;

/*Build a model with Conf Intervals by limiting analysis to < 4500 sf and adding interactions - Display 5, 13, 17*/
proc glm data = HPA plots = all;
where GrLivArea < 4500;
class Neighborhood;
model SalePrice = GrLivArea | Neighborhood /solution clparm;
run;

/*Fit a model and get diagnostic statistics - Display 14*/
proc glmselect data=HPA plots = all; 
   class Neighborhood; 
   model SalePrice = GrLivArea|Neighborhood/selection= Forward (stop=CV) cvmethod=random(5) stats=adjrsq; 
run; 

/*Fit a model and get diagnostic statistics by limiting analysis to < 4500 sf - Display 15*/
proc glmselect data=HPA plots = all; 
where GrLivArea < 4500;
   class Neighborhood; 
   model SalePrice = GrLivArea Neighborhood/selection= Forward (stop=CV) cvmethod=random(5) stats=adjrsq; 
run; 

/*Fit a model and get diagnostic statistics by limiting analysis to < 4500 sf and adding interactions - Display 16*/
proc glmselect data=HPA plots = all; 
where GrLivArea < 4500;
   class Neighborhood; 
   model SalePrice = GrLivArea|Neighborhood/selection= Forward (stop=CV) cvmethod=random(5) stats=adjrsq; 
run; 
 


